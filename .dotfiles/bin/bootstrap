#!/bin/bash

set -e

packages=(software-properties-common)

sudo apt update

for package in "${packages[@]}"; do
  if ! command -v "$package" &> /dev/null; then
    sudo apt install -y "$package"
  fi
done

sudo add-apt-repository -y -u ppa:ansible/ansible
sudo apt update
sudo DEBIAN_FRONTEND=noninteractive apt install -y --no-install-recommends ansible

if command -v ansible-galaxy &> /dev/null; then
  ansible-galaxy collection install -r "$HOME/.dotfiles/ansible/requirements.yml"
fi

if command -v ansible &> /dev/null; then
  ansible-playbook "$HOME/.dotfiles/ansible/playbook.yml"
fi

